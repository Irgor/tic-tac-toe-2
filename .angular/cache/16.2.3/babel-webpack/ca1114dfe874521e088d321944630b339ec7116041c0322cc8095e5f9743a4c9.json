{"ast":null,"code":"var _class;\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/moves-controll.service\";\nimport * as i2 from \"src/app/services/socket.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../components/field/field.component\";\nfunction GameComponent_div_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"app-field\", 5)(2, \"div\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const j_r5 = ctx.index;\n    const i_r2 = i0.ɵɵnextContext().index;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"i\", i_r2)(\"j\", j_r5)(\"player\", ctx_r3.player);\n  }\n}\nfunction GameComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtemplate(1, GameComponent_div_1_div_1_Template, 3, 3, \"div\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const fieldRow_r1 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", fieldRow_r1);\n  }\n}\nclass GameComponent {\n  constructor(moveControll, socket) {\n    this.moveControll = moveControll;\n    this.socket = socket;\n    this.fieldMap = [['', '', ''], ['', '', ''], ['', '', '']];\n    this.controllField = [['', '', ''], ['', '', ''], ['', '', '']];\n    this.nextMove = '';\n    this.endedGames = [];\n    this.player = 'X';\n    this.moveControll.endedGames.next([]);\n    this.socket.listenMoves();\n  }\n  ngOnInit() {\n    this.endedGamesSub = this.moveControll.endedGames.subscribe({\n      next: games => {\n        this.endedGames = games;\n        for (let game of games) {\n          this.controllField[game.i][game.j] = game.winner;\n        }\n        this.checkDraw();\n        this.checkWin();\n      }\n    });\n    this.moveSub = this.moveControll.gameToMove.subscribe({\n      next: game => {\n        this.nextMove = game.mover;\n      }\n    });\n    this.socket.getPlayer().subscribe(player => {\n      this.player = player;\n    });\n  }\n  checkDraw() {\n    if (this.endedGames.length == 9) {\n      this.endGame('DEU VELHA VELHA');\n    }\n  }\n  checkWin() {\n    for (let i of this.controllField) {\n      this.getRow(i);\n    }\n    for (let i = 0; i < this.controllField.length; i++) {\n      let line = [this.controllField[0][i], this.controllField[1][i], this.controllField[2][i]];\n      this.getRow(line);\n    }\n    let leftDiag = [this.controllField[0][0], this.controllField[1][1], this.controllField[2][2]];\n    this.getRow(leftDiag);\n    let rightDiag = [this.controllField[2][0], this.controllField[1][1], this.controllField[0][2]];\n    this.getRow(rightDiag);\n  }\n  getRow(row) {\n    const line = row[0] + row[1] + row[2];\n    let winner = Array.from(new Set(line.split('')));\n    let win = winner.length == 1 && line.length == 3;\n    if (win) {\n      this.endGame('O VENCEDOR É ' + winner);\n    }\n  }\n  endGame(message) {\n    this.ngOnDestroy();\n    alert(message);\n    setTimeout(() => {\n      location.reload();\n    }, 1000);\n  }\n  ngOnDestroy() {\n    this.endedGamesSub?.unsubscribe();\n    this.moveSub?.unsubscribe();\n  }\n}\n_class = GameComponent;\n_class.ɵfac = function GameComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.MovesControllService), i0.ɵɵdirectiveInject(i2.SocketService));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"app-game\"]],\n  decls: 2,\n  vars: 1,\n  consts: [[1, \"field-holder\"], [\"class\", \"col\", 4, \"ngFor\", \"ngForOf\"], [1, \"col\"], [\"class\", \"row sqr\", 4, \"ngFor\", \"ngForOf\"], [1, \"row\", \"sqr\"], [3, \"i\", \"j\", \"player\"]],\n  template: function GameComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtemplate(1, GameComponent_div_1_Template, 2, 1, \"div\", 1);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.fieldMap);\n    }\n  },\n  dependencies: [i3.NgForOf, i4.FieldComponent],\n  styles: [\".field-holder[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\n.next-move[_ngcontent-%COMP%] {\\n  font-family: \\\"Nunito\\\", sans-serif;\\n  font-size: 10rem;\\n  position: absolute;\\n  top: 50px;\\n  left: 50px;\\n  -webkit-user-select: none;\\n          user-select: none;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvZ2FtZS9nYW1lLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksYUFBQTtFQUNBLG1CQUFBO0VBQ0EsdUJBQUE7RUFDQSxtQkFBQTtBQUNKOztBQUVBO0VBQ0ksaUNBQUE7RUFDQSxnQkFBQTtFQUNBLGtCQUFBO0VBQ0EsU0FBQTtFQUNBLFVBQUE7RUFDQSx5QkFBQTtVQUFBLGlCQUFBO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIuZmllbGQtaG9sZGVyIHtcclxuICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICBmbGV4LWRpcmVjdGlvbjogcm93O1xyXG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XHJcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG59XHJcblxyXG4ubmV4dC1tb3ZlIHtcclxuICAgIGZvbnQtZmFtaWx5OiAnTnVuaXRvJywgc2Fucy1zZXJpZjtcclxuICAgIGZvbnQtc2l6ZTogMTByZW07XHJcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICB0b3A6IDUwcHg7XHJcbiAgICBsZWZ0OiA1MHB4O1xyXG4gICAgdXNlci1zZWxlY3Q6IG5vbmU7XHJcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});\nexport { GameComponent };","map":{"version":3,"names":["i0","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","ɵɵadvance","ɵɵproperty","i_r2","j_r5","ctx_r3","player","ɵɵtemplate","GameComponent_div_1_div_1_Template","fieldRow_r1","GameComponent","constructor","moveControll","socket","fieldMap","controllField","nextMove","endedGames","next","listenMoves","ngOnInit","endedGamesSub","subscribe","games","game","i","j","winner","checkDraw","checkWin","moveSub","gameToMove","mover","getPlayer","length","endGame","getRow","line","leftDiag","rightDiag","row","Array","from","Set","split","win","message","ngOnDestroy","alert","setTimeout","location","reload","unsubscribe","ɵɵdirectiveInject","i1","MovesControllService","i2","SocketService","selectors","decls","vars","consts","template","GameComponent_Template","rf","ctx","GameComponent_div_1_Template"],"sources":["C:\\Users\\igorn\\tic-tac-toe-2\\src\\app\\pages\\game\\game.component.ts","C:\\Users\\igorn\\tic-tac-toe-2\\src\\app\\pages\\game\\game.component.html"],"sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { MovesControllService } from 'src/app/services/moves-controll.service';\nimport { SocketService } from 'src/app/services/socket.service';\n\n@Component({\n  selector: 'app-game',\n  templateUrl: './game.component.html',\n  styleUrls: ['./game.component.scss']\n})\nexport class GameComponent implements OnInit, OnDestroy {\n\n  fieldMap = [\n    ['', '', ''],\n    ['', '', ''],\n    ['', '', ''],\n  ]\n\n  controllField = [\n    ['', '', ''],\n    ['', '', ''],\n    ['', '', ''],\n  ]\n\n  nextMove = '';\n  endedGames: any = [];\n\n  endedGamesSub?: Subscription;\n  moveSub?: Subscription;\n\n  player = 'X';\n\n  constructor(\n    private moveControll: MovesControllService,\n    private socket: SocketService\n  ) {\n    this.moveControll.endedGames.next([]);\n    this.socket.listenMoves();\n  }\n\n  ngOnInit(): void {\n    this.endedGamesSub = this.moveControll.endedGames.subscribe({\n      next: games => {\n        this.endedGames = games;\n        for (let game of games) {\n          this.controllField[game.i][game.j] = game.winner;\n        }\n        this.checkDraw();\n        this.checkWin();\n      }\n    });\n\n    this.moveSub = this.moveControll.gameToMove.subscribe({\n      next: game => {\n        this.nextMove = game.mover;\n      }\n    })\n\n    this.socket.getPlayer().subscribe(player => {\n      this.player = player as string\n    })\n  }\n\n  checkDraw() {\n    if (this.endedGames.length == 9) {\n      this.endGame('DEU VELHA VELHA')\n    }\n  }\n\n  checkWin() {\n    for (let i of this.controllField) {\n      this.getRow(i);\n    }\n\n    for (let i = 0; i < this.controllField.length; i++) {\n      let line = [this.controllField[0][i], this.controllField[1][i], this.controllField[2][i]];\n      this.getRow(line);\n    }\n\n    let leftDiag = [this.controllField[0][0], this.controllField[1][1], this.controllField[2][2]];\n    this.getRow(leftDiag);\n\n    let rightDiag = [this.controllField[2][0], this.controllField[1][1], this.controllField[0][2]];\n    this.getRow(rightDiag);\n  }\n\n\n  getRow(row: string[]) {\n    const line = row[0] + row[1] + row[2];\n    let winner = Array.from(new Set(line.split('')));\n    let win = winner.length == 1 && line.length == 3;\n\n    if (win) {\n      this.endGame('O VENCEDOR É ' + winner);\n    }\n  }\n\n  endGame(message: string) {\n    this.ngOnDestroy();\n    alert(message)\n    setTimeout(() => {\n      location.reload();\n    }, 1000);\n  }\n\n  ngOnDestroy(): void {\n    this.endedGamesSub?.unsubscribe();\n    this.moveSub?.unsubscribe();\n  }\n\n}\n","<!-- <div class=\"next-move\">\r\n    {{nextMove}}\r\n</div> -->\r\n<div class=\"field-holder\">\r\n    <div *ngFor=\"let fieldRow of fieldMap; index as i\" class=\"col\">\r\n        <div *ngFor=\"let field of fieldRow; index as j\" class=\"row sqr\">\r\n            <app-field [i]=\"i\" [j]=\"j\" [player]=\"player\"></app-field>\r\n        <div>\r\n    </div>\r\n</div>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}